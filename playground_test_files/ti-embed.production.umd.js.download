(function(c,f){typeof exports=="object"&&typeof module!="undefined"?module.exports=f():typeof define=="function"&&define.amd?define(f):(c=typeof globalThis!="undefined"?globalThis:c||self,c.TiEmbed=f())})(this,function(){"use strict";var c="@widget-kit/rpc/request",f="@widget-kit/rpc/response";function y(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return{method:e,args:n,type:c,sequenceId:0}}function v(e,n,t){return{payload:n,error:t,type:f,sequenceId:e.sequenceId}}function g(e,n,t){t===void 0&&(t="*");var l=function(o){return n.postMessage(o,t)},r={};function i(o){var a=r[o.method];if(typeof a=="function"){var H=function(R,j){l(v(o,R,j))};a.apply(void 0,[H].concat(o.args))}}var u={};function h(o){var a=u[o.sequenceId];typeof a=="function"&&(a(o),delete r[o.sequenceId])}e.addEventListener("message",function(o){if(!!b(o,n,t)){var a=q(o.data);if(!!a)switch(a.type){case c:return i(a);case f:return h(a)}}});var d=S();return{handle:function(o,a){if(typeof r[o]=="function")throw new Error("Handler for "+o+" already declared");r[o]=a},send:function(o,a){o.sequenceId=d(),a&&(u[o.sequenceId]=a),l(o)}}}function S(){var e=0;return function(){return e+=1,e}}function b(e,n,t){return e.source===n&&(t==="*"||e.origin===t)}function q(e){return e&&typeof e.sequenceId=="number"&&typeof e.type=="string"?e:null}function E(e,n){return n===void 0&&(n="*"),g(window,e,n)}function C(e,n){var t=n.match(/^(https?:)?\/\/[.\w]+(:\d+)?/i);if(!t)throw new Error("Invalid url");return t[0].replace(/^\/\//,e.location.protocol+"//")}function P(e,n){n===void 0&&(n={});var t=window.document,l=n.parentElement||t.body,r=t.createElement("iframe");r.src=e,r.frameBorder="0",r.scrolling="no",l.appendChild(r);var i=r.contentWindow,u=C(window,e),h=E(i,u),d=h.send,o=h.handle;return{send:d,handle:o,iframe:r}}function x(e,n){n===void 0&&(n={});var t=e.iframe,l=e.handle;function r(i){i.top&&(t.style.top=i.top),i.left&&(t.style.left=i.left),i.right&&(t.style.right=i.right),i.bottom&&(t.style.bottom=i.bottom)}t.style.position="fixed",n.initialPosition&&r(n.initialPosition),l("plugins.positionFixed.setPosition",function(i,u){r(u)})}function I(e,n){n===void 0&&(n={});var t=e.iframe,l=e.handle;function r(i){i.width&&(t.style.width=i.width),i.height&&(t.style.height=i.height),i.maxWidth&&(t.style.maxWidth=i.maxWidth),i.maxHeight&&(t.style.maxHeight=i.maxHeight)}n.initialSize&&r(n.initialSize),l("plugins.size.setSize",function(i,u){r(u)})}function T(e){return e.setAttribute("allow","gyroscope; accelerometer; fullscreen; autoplay; speaker"),e.setAttribute("allowfullscreen","true"),e.setAttribute("scrolling","yes"),e.style.overflow="auto",e.style.transitionDuration="200ms",e.style.transitionTimingFunction="ease-in",e.style.transitionProperty="none",e.classList.add("ti-embed-widget"),e}const p="432px";let m;typeof window.matchMedia!="undefined"&&(m=window.matchMedia("screen and (min-width: 600px)"),m.addEventListener("change",e=>{if(s){let n={browserSize:e.matches?"desktop":"mobile"};s.send(y("browserSize",n)),n.browserSize==="desktop"&&s.iframe.style.width==="100%"?s.iframe.style.width=p:n.browserSize==="mobile"&&s.iframe.style.width!=="0"&&(s.iframe.style.width="100%")}}));const s=P("https://d36ai2hkxl16us.cloudfront.net/ti-embed-widget/v2/dist/widget-72c607fd.html");T(s.iframe),I(s,{initialSize:{width:"0",height:"0"}}),x(s);function k(e){if(s){const t=e.target.getAttribute("data-ti-embed");t&&(e.preventDefault(),w(void 0,{embed:t}))}}document.addEventListener&&document.addEventListener("click",k),s.handle("getSettings",e=>{const{jwt:n,...t}=window.TiEmbedSettings||{};e(t)}),s.handle("stopAnimation",()=>{s.iframe.style.transitionProperty="none"}),s.handle("forceOpen",()=>{w()}),s.handle("onClose",()=>{const{containerClassName:e,openStyle:n}=window.TiEmbedSettings||{};if(e&&n==="push"){const t=document.querySelector(e);t&&(t.style.transform="translateX(0)")}else if(e&&n==="squish"){const t=document.querySelector(e);t&&(t.style.width="100%")}});function w(e,n){let t=window.TiEmbedSettings||{};n&&(t={...t,...n});const{jwt:l,...r}=t;let i;typeof l=="string"?i=Promise.resolve(l):typeof l=="function"?i=l():i=Promise.resolve(null),i.then(u=>{const h=y("open",{settings:r,jwt:u||void 0,url:e||window.location.pathname+window.location.search,browserSize:m?m.matches?"desktop":"mobile":null});if(s.iframe.style.transitionProperty="width, max-width",s.iframe.style.zIndex="1001",r.openStyle==="push"&&r.containerClassName){const d=document.querySelector(r.containerClassName);d?(d.style.transform=`translateX(-${p})`,d.style.transitionProperty="transform",d.style.transitionDuration="0.2s"):console.warn("Could not find containerClassName",r.containerClassName)}if(r.openStyle==="squish"&&r.containerClassName){const d=document.querySelector(r.containerClassName);d?(d.style.width=`calc(100% - ${p})`,d.style.transitionProperty="width",d.style.transitionDuration="0.2s"):console.warn("Could not find containerClassName",r.containerClassName)}s.send(h)}).catch(u=>{console.error("[ti-embed] There was an error resolving your jwt: ",u)})}var N={open(e,n){w(e,n)}};return N});
